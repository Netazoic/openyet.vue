INSERT INTO combined(	sourcecode,	statecode,	state,	country,	positive,	positiveincrease,	negative,	negativeincrease,	totaltestresults,	totaltestresultsincrease,	hospitalized,	hospitalizedincrease,	death,	deathincrease,	recovered,	recoveredincrease,	datechecked,	date)SELECT	'CTP' as sourcecode,	state.ansi,	state.name,	country,	positive,	positiveincrease,	negative,	negativeincrease,	totaltestresults,	totaltestresultsincrease,	hospitalized,	hospitalizedincrease,	death,	deathincrease,	null as recovered,	null as recoveredincrease,	datechecked,	to_date(substring(datechecked from 1 for 10),'YYYY-MM-DD') as date		-- 2020-03-15T20:00:00ZFROM ctp_statesdaily ctpJOIN state on (ctp.state = state.ansi);--UPDATE combined SET date = to_date(substring(datechecked from 1 for 10), 'YYYY-MM-DD') WHERE sourcecode = 'CTP';UPDATE combinedSET positive = v1.positiveFROM( SELECT country,'USA' as countrycode,sum(positive) as positive,sum(positiveincrease) as positiveincrease,sum(negative) as negative,sum(negativeincrease) as negativeincrease,sum(hospitalized) as hospitalized,sum(hospitalizedincrease) as hospitalizedincrease,sum(death) as death,sum(deathincrease) as deathincrease,to_date(substring(datechecked from 1 for 10),'YYYY-MM-DD') as dateFROM ctp_statesdailyWHERE 1=1 -- countrycode = 'USA'AND state is not null AND state != ''GROUP BY country, date, countrycode) AS v1WHERE ((combined.state is null))AND combined.countrycode = v1.countrycodeAND combined.date = v1.date;